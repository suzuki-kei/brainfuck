# Brainfuck

プログラミング言語 Brainfuck のインタプリタです。

 * https://brainfuck.org/

## インストール

環境変数 PATH に ./bin/ を追加します.
もしくは, ./bin/ 配下の実行ファイルを直接実行します.

## 実行ファイル

### ./bin/brainfuck

Brainfuck のインタプリタです.
以下のように指定したソースコードを実行します.

    # 引数を指定しない場合は標準入力からの入力待ちにります.
    ./bin/brainfuck

    # ソースコードをファイルで指定することもできます.
    ./bin/brainfuck samples/hello.b

    # パイプ経由でソースコードを指定することもできます.
    echo '+++++++++++++[->++++++++<]>.---.+++++++..+++.' | ./bin/brainfuck

### ./bin/brainfuck.generator1

指定した文字列を出力する Brainfuck コードを生成するジェネレータです.

    # 引数を指定しない場合は標準入力からの入力待ちにります.
    ./bin/brainfuck.generator1

    # 文字列をファイルで指定することもできます.
    ./bin/brainfuck.generator1 hello.txt

    # パイプ経由で文字列を指定することもできます.
    echo -ne 'Hello, World!\r\n' | bin/brainfuck.generator1

以下のように 1 文字ずつ, 必要な回数 `+` を繰り返すコードを生成します.
出力の最初の 1 行目は, 生成したコードに含まれる有効なコマンドの数です.

    $ echo -ne 'Hello' | bin/brainfuck.generator1
    509
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.>
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.>
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.>
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.>
    +++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.

### ./bin/brainfuck.generator2

generator1 の改良版です.
コードが短くなる場合は直前に生成した値を利用するコードを生成します.

    $ echo -ne 'Hello' | bin/brainfuck.generator2
    116
    ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++.
    +++++++++++++++++++++++++++++.
    +++++++.
    .
    +++.

### ./bin/brainfuck.generator3

generator2 の改良版です.
コードが短くなる場合は `[` と `]` を用いてループするコードを生成します.

    $ echo -ne 'Hello' | bin/brainfuck.generator3
    57
    +++++++++[->++++++++<]>.
    <+++++++[->++++<]>+.
    +++++++.
    .
    +++.

### ./bin/brainfuck.generator4

ループで複数の値を生成し, それを変更しながら出力するコードを生成します.

    $ echo -ne 'Hello, World!\r\n' | bin/brainfuck.generator4
    143
    ++++++++
    [
        -
        >
        >++++++++
        >+++
        >++++++++++++
        >+++++
        [+<]
        <
    ]
    >>.
    >>---.
    +++++++.
    .
    +++.
    >----.
    <<.
    <+++++++++++++++.
    >>.
    +++.
    ------.
    --------.
    <+.
    <<+++++++++++++.
    ---.

### ./bin/brainfuck.minify

ソースコードからコマンド以外の文字を削除します.

    # 引数を指定しない場合は標準入力からの入力待ちにります.
    ./bin/brainfuck.minify

    # ソースコードをファイルで指定することもできます.
    ./bin/brainfuck.minify samples/hello.b

    # パイプ経由でソースコードを指定することもできます.
    echo 'A+++++++++++++[-A>B++++++++B<A]A>B.---.+++++++..+++.' | ./bin/brainfuck.minify

## 設計方針

本インタプリタは以下の方針で設計します.

(1) 言語仕様を最低限満たす.

例えば, 言語仕様には "セルは少なくとも 30000 個" と記述されています.
この場合, 本インタプリタでは "セルは厳密に 30000 個" とします.

(2) 最小限を定義できず, 選択肢が複数ある場合はエラー終了する.

例えば, 言語仕様には "最大値のセルに + すると最小値になることもあるし, ならないこともある" と記述されています.
この場合, 本インタプリタではエラーとします.

## 実装仕様

 * セルの個数
   - 言語仕様: セルは少なくとも 30000 個.
   - 実装仕様: セルは厳密に 30000 個.
 * セルが保持できる値の範囲
   - 言語仕様: セルは少なくとも 1 バイトの整数値を保持できる.
   - 実装仕様: セルは厳密に -128 以上 127 以下の整数値を保持できる.
 * セルの初期値
   - 言語仕様: セルの初期値は 0.
   - 実装仕様: 言語仕様通り.
 * ポインタの初期値
   - 言語仕様: ポインタは初期状態で最も左のセルを指す.
   - 実装仕様: 言語仕様通り.
 * コントロールフロー
   - 言語仕様: 最初のコマンドから開始する. コマンドに制御権があれば実行し, デフォルトで次のコマンドに制御権が移る. 制御権のあるコマンドが存在しない場合はプログラムが終了する.
   - 実装仕様: 言語仕様通り.
 * "+" コマンド
   - 言語仕様: セルの値を 1 増やす. 既にセルが最大値だった場合は最小値になる場合がある (ならない場合もある).
   - 実装仕様: セルの値を 1 増やす. 既にセルが最大値だった場合はエラー終了する.
 * "-" コマンド
   - 言語仕様: セルの値を 1 減らす. 既にセルが最小値だった場合は最大値になる場合がある (ならない場合もある).
   - 実装仕様: セルの値を 1 減らす. 既にセルが最小値だった場合はエラー終了する.
 * ">" コマンド
   - 言語仕様: ポインタを 1 つ右のセルに移動する. 既に一番右のセルだった場合の結果は予測できない.
   - 実装仕様: ポインタを 1 つ右のセルに移動する. 既に一番右のセルだった場合はエラー終了する.
 * "<" コマンド
   - 言語仕様: ポインタを 1 つ左のセルに移動する. 既に一番左のセルだった場合の結果は予測できない.
   - 実装仕様: ポインタを 1 つ左のセルに移動する. 既に一番左のセルだった場合はエラー終了する.
 * "[" コマンド
   - 言語仕様: セルの値が 0 の場合は, 次のコマンドではなく対応する "]" に制御権を渡す.
   - 実装仕様: 言語仕様通り.
 * "]" コマンド
   - 言語仕様: セルの値が 0 以外の場合は, 次のコマンドではなく対応する "[" に制御権を渡す.
   - 実装仕様: 言語仕様通り.
 * "[" と "]" が対応しない場合
   - 言語仕様: 構文エラーとなる.
   - 実装仕様: 言語仕様通り.
 * "." コマンド
   - 言語仕様: セルの値を出力する. 値が 1 バイトに収まらない場合は 256 を法として減算される場合がある.
   - 実装仕様: セルの値を出力する (セルの値は厳密に 1 バイトのため, 1 バイトに収まらない状況は発生しない).
 * "," コマンド
   - 言語仕様: 1 バイトの入力を要求し, 受け取った値があればセルに設定する.
   - 実装仕様: 1 バイトの入力を要求し, 受け取った値があればセルに設定する. 入力が無い場合は何もしない (セルの値は変化しない).

## 設計方針に反する実装仕様

(1) セルが保持できる値の範囲は -128 以上 127 以下です.

可搬性よりも言語仕様を守ることを優先しました.

判断材料:
 * 言語仕様は, セルは少なくとも 1 バイトの整数値を保持できると定義している.
 * 言語仕様は, 符号の有無は定義していない.
 * ISO/IEC 80000-13:2008 は, 1 バイトは 8 ビットであると定義している.
 * 言語仕様は, セルの値がオーバーフロー/アンダーフローした場合について定義していない.
 * 言語仕様 (少なくとも 1 バイト) に反するよりは, 実装依存 (符号あり) を選択する.
 * 可搬性のあるコードを書くなら 0 以上 127 以下に収まるようにしなければならない.

選択肢:
 * セルが保持できる値の範囲を -128 以上 127 以下とする.
 * セルが保持できる値の範囲を 0 以上 255 以下とする.
 * セルが保持できる値の範囲を 0 以上 127 以下とする.

(2) "," 実行時に入力がもう無い場合はセルの値は変化しません.

可搬性よりも言語仕様を守ることを優先しました.

判断材料:
 * https://brainfuck.org/epistle.html で値を設定しないことが恣意性が低いとされている.

選択肢:
 * 入力がもう無い場合は 0 を設定する.
 * 入力がもう無い場合は -1 を設定する.
 * 入力がもう無い場合は何もしない (セルの値は変化しない).

